<% content_for :title do %>
  Shift List
<% end %>

<%= render partial: "date_display", locals:{
  prev_page: advocate_schedule_path(month: @prev_month),
  next_page: advocate_schedule_path(month: @next_month),
} %>

<h1>Schedule</h1>

<% ["Sun", "Mon", "Tues", "Wed", "Thu", "Fri", "Sat"].each do |day| %>
  <div class="date header">
    <%= day %><br/>
  </div>
<% end %>

<div class="clear"></div>

<% @presenter.dates.each_with_index do |date, i| %>
  <div class="date <%= @presenter.working_on?(date, @current_employee) ? "highlight" : "" %>"
       id="<%= date.strftime("%m-%d") %>">
    <%= date.strftime("%-m/%e").gsub(" ", "") %>
  </div>

  <% if i > 0 && ((i + 1) % 7) == 0 %>
    <div class="clear"></div>
  <% end %>
<% end %>

<% @presenter.dates.each_with_index do |date, i| %>
  <div id="schedule_<%= date.strftime("%m-%d") %>" class="schedule_days hidden">
    <% timeline = @presenter.timeline(date) %>

    <table class="clear">
        <tr>
          <th></th>
          <% timeline.each do |hour_label, _|%>
            <th><%= hour_label %></th>
          <% end %>
        </tr>
        <tr>
          <th>RNs</th>
          <% timeline.each do |_, hour|%>
          <td class="rn_pct rn_pct_<%= [hour[:pct].floor(-1), 100].min %>">
              <%= hour[:rns] %>
            </td>
          <% end %>
        </tr>
    </table>

    <div class="clear"></div>
    <div class="shift_block">
      <% shifts = @presenter.shifts_for(date) %>
      Day <br/>
      <%= render partial: "shift", locals: {shift: shifts[:day][:us]} %>
      <% shifts[:day][:rns].each do |shift| %>
        <%= render partial: "shift", locals: {shift: shift} %>
      <% end %>
    </div>

    <div class="shift_block">
      <% if shifts[:swing][:rns].length > 0 %>
        Swing <br/>
        <% shifts[:swing][:rns].each do |shift| %>
          <%= render partial: "shift", locals: {shift: shift} %>
        <% end %>
      <% end %>
    </div>

    <div class="shift_block">
      Night <br/>
      <%= render partial: "shift", locals: {shift: shifts[:night][:us]} %>
      <% shifts[:night][:rns].each do |shift| %>
        <%= render partial: "shift", locals: {shift: shift} %>
      <% end %>
    </div>

    <div class="clear"></div>
      <% if shifts[:unsorted].length > 0 %>
        Also <br/>
        <% shifts[:unsorted].each do |shift| %>
          <%= render partial: "shift", locals: {shift: shift} %>
        <% end %>
      <% end %>
  </div>
<% end %>
